YUI.add("photo-model-helper",(function(e,t){var i=require("hermes-core/flog")(t);e.PhotoModelHelper={updateEngagement:function(t,i){var r,n=[];return e.Lang.isObject(i,!0)&&"isFaved"in i&&(r=i.isFaved.newVal?"flickr-favorites-add":"flickr-favorites-remove",n.push(e.ModelUpdaters[r].run({photoId:t},this.appContext))),e.Promise.all(n)},toggleFave:function(t){var i=this.getValue(t,"faveCount"),r=!this.getValue(t,"isFaved"),n="photo-engagement-models",o=i+(r?1:-1),s=this.appContext.getViewer();this.setValues(t,{isFaved:r,faveCount:o}),s&&this.appContext.getModelRegistry("photo-people-who-faved-models").then((function(e){var i=e.exists(t)?e.proxy(t):void 0;i&&(r?i.addFave(s.nsid):i.removeFave(s.nsid))})),this.name!==n?this.appContext.getModelRegistry(n).then((function(e){e.exists(t)&&e.toggleFave(t)})):e.Snowplough&&this.appContext.getModel("photo-models",t).then(function(t){e.Snowplough.sendStructuredEvent({category:"engagement",action:r?"fave":"unfave"},e.Snowplough.getPhotoContextFromModel(t))}.bind(this))},addAsFave:function(e){var t=this.getValue(e,"faveCount"),i=this.getValue(e,"isFaved"),r="photo-engagement-models";return i||this.setValues(e,{isFaved:!0,faveCount:t+1}),this.name!==r&&this.appContext.getModelRegistry(r).then((function(t){t.exists(e)&&t.toggleFave(e)})),!i},getLargestSize:function(e,t){return this.getSizeToFit(e,{width:Number.MAX_VALUE,height:Number.MAX_VALUE},t)},getSizeToFit:function(t,r,n){n=n||{};var o,s,a,u,l=this,d=r.width,h=r.height,c=!!n.cropToFit,g=n.includeSquare,v=n.sizes||this.getValue(t,"sizes"),f=n.excludeSizes||["o"],p=n.includeSizes;if(void 0===n.includeSizes)try{p=Object.keys(v)}catch(e){i.warn("getSizeToFit with invalid sizes",{err:e,sizes:v})}return this._getSizeToFitMemo=this._getSizeToFitMemo||{},o=[t,d,h,c,f.sort().join(""),p.sort().join("")].join("_"),this._getSizeToFitMemo[o]||(e.Object.each(v,(function(e,i){var r,n,o,l,v;e&&-1===f.indexOf(i)&&p.indexOf(i)>-1&&(g||!this.isSizeSquare(i)||this.isPhotoSquare(t))&&(r=parseInt(e.width,10),n=parseInt(e.height,10),(c&&r>=d&&n>=h||!c&&(r>=d||n>=h))&&(o=!0),o&&(s?n<parseInt(s.height,10)&&(s=e):s=e),a?(l=parseInt(a.width,10),v=parseInt(a.height,10),(r>l||n>v)&&(a=e)):a=e),u=s||a}),this),this._getSizeToFitMemo[o]=u,this._getSizeToFitMemoTimer||(this._getSizeToFitMemoTimer=setTimeout((function(){delete l._getSizeToFitMemo,delete l._getSizeToFitMemoTimer}),1e4))),e.clone(this._getSizeToFitMemo[o],!0)},getSizeIfExact:function(e,t){var i,r,n=this.getValue(e,"sizes");return Object.keys(n).some((function(e){return"o"!==e&&(r=n[e],t.height===r.height&&t.width===r.width&&(i=r,!0))})),i},isSizeSquare:function(e){return["sq","q"].indexOf(e)>-1},isPhotoSquare:function(t){var i;return this._isPhotoSquareMemo=this._isPhotoSquareMemo||{},void 0!==this._isPhotoSquareMemo[t]?i=this._isPhotoSquareMemo[t]:(i=!0,e.Object.some(this.getValue(t,"sizes"),(function(e,t){if(e&&e.width&&e.height&&!this.isSizeSquare(t)&&1!==parseInt(e.width,10)/parseInt(e.height,10))return i=!1,!0}),this),this._isPhotoSquareMemo[t]=i),i},getSizeForCanvas:function(e,t,i,r){r=r||1;var n,o,s=this.getSizeToFit(e,{width:t*r,height:i*r});return n=Math.min(i/r,s.height),o=Math.min(t/r,s.width/s.height*n),n=Math.min(n,s.height/s.width*o),{width:Math.round(o),height:Math.round(n),url:s.url,pixelRatio:s.width/o}},getPhotoLicenseInformation:function(e){let t=this.getValue(e,"license");return[{value:"0",text:"All rights reserved",key:"settings.ALL_RIGHTS_RESERVED",url:"https://flickrhelp.com/hc/en-us/articles/4404078674324-Change-Your-Photo-s-License-in-Flickr"},{value:"10",text:"Public Domain Work",key:"settings.PUBLIC_DOMAIN_WORK",url:"https://creativecommons.org/publicdomain/mark/1.0/"},{value:"9",text:"Public Domain Dedication (CC0)",key:"settings.PUBLIC_DOMAIN_DEDICATION",url:"https://creativecommons.org/publicdomain/zero/1.0/"},{value:"4",text:"Attribution",key:"settings.ATTRIBUTION",url:"https://creativecommons.org/licenses/by/2.0/"},{value:"5",text:"Attribution-ShareAlike",key:"settings.ATTRIBUTION_SHAREALIKE",url:"https://creativecommons.org/licenses/by-sa/2.0/"},{value:"6",text:"Attribution-NoDerivs",key:"settings.ATTRIBUTION_NODERIVS",url:"https://creativecommons.org/licenses/by-nd/2.0/"},{value:"2",text:"Attribution-NonCommercial",key:"settings.ATTRIBUTION_NONCOMMERCIAL",url:"https://creativecommons.org/licenses/by-nc/2.0/"},{value:"1",text:"Attribution-NonCommercial-ShareAlike",key:"settings.ATTRIBUTION_NONCOMMERCIAL_SHAREALIKE",url:"https://creativecommons.org/licenses/by-nc-sa/2.0/"},{value:"3",text:"Attribution-NonCommercial-NoDerivs",key:"settings.ATTRIBUTION_NONCOMMERCIAL_NODERIVS",url:"https://creativecommons.org/licenses/by-nc-nd/2.0/"},{value:"7",text:"No known copyright restrictions",key:"settings.NO_COPYRIGHT_RESTRICTIONS",url:"/commons/usage/"},{value:"8",text:"United States government work",key:"settings.US_GOV_WORK",url:"http://www.usa.gov/copyright.shtml"}].find((e=>e.value===t.toString()))},attributes:{title:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},mediaType:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"photo"},contentType:{validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){return"video"===this.getValue(t,"mediaType")}},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var i=this.getValue(t,"owner"),r=this.appContext.getViewer();return!!r.signedIn&&i.getValue("id")===r.nsid}},sizes:{},descendingSizes:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(e){var t,i,r=[];if(this._descendingSizesMemo=this._descendingSizesMemo||{},this._descendingSizesMemo[e])return this._descendingSizesMemo[e];for(i in t=this.getValue(e,"sizes"))r.push(t[i]),r[r.length-1].key=i;return r.sort((function(e,t){return e.width<t.width?1:e.width===t.width?e.height<t.height?1:e.height===t.height?"o"===e.key?-1:1:-1:-1})),this._descendingSizesMemo[e]=r,r}},ascendingSizes:{readOnly:!0,derivedBy:["descendingSizes"],defaultFn:function(e){return this.getValue(e,"descendingSizes").reverse()}},aspectRatio:{readOnly:!0,derivedBy:["descendingSizes","rotation"],defaultFn:function(e){var t=this.getValue(e,"descendingSizes").find((function(e){return"o"!==e.key}));return t.width/t.height}},needsInterstitial:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},canPublicComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/"+e:void 0}},rotation:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},ownerNsid:{},isFaved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},canFave:{readOnly:!0,derivedBy:["is_owner"],getter:function(e,t){return!this.getValue(t,"isOwner")}},canPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}}}),"@VERSION@",{requires:["flickr-favorites-add-updater","flickr-favorites-remove-updater","photo-engagement-models","photo-people-who-faved-models"],optionalRequires:["hermes-core"]});YUI.add("flickr-photos-setPerms-updater",(function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:function(s,o){var t=this;return s.nsid=o.getViewer().nsid,e.Promise.all([o.callAPI("flickr.photos.setPerms",s),o.getModelRegistry("photostream-models")]).then((function(e){return t._processResponse(e,s)}),e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s=e[0],o=e[1];if(o.attributeSearch({normalizedId:r.nsid},!0).forEach((function(e){o.remove(e)})),r.full_response)return s.photoIdsSent=r.photo_ids,s}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setMeta-updater",(function(t,e){"use strict";var o=require("hermes-core/flog")(e);t.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:function(r,i){var s={};return r.fullResponse?(s.full_response=1,s.photo_ids=r.photoId):s.photo_id=r.photoId,void 0!==r.title&&(s.title=r.title),void 0!==r.description&&(s.description=r.description),t.Promise.all([i.callAPI("flickr.photos.setMeta",s),i.getModelRegistry("photo-models")]).then((function(t){var e=t[0],i=t[1];if(r.fullResponse){if("errors"in e)return e.api="setMeta",e}else{if(!i.exists(r.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");e.photo&&e.photo.title&&e.photo.description?i.setValues(r.photoId,{title:e.photo.title.content,description:e.photo.description.content}):o.warn("No updated data returned from API.")}}),(function(t){throw r.fullResponse&&(t.photoIds=r.photoId,t.returnApi="setMeta"),t})).then(null,t.FetcherErrorLogger(e))}}}),"@VERSION@",{requires:["flickr-promise"],optionalRequires:["hermes-core"],optional:[]});YUI.add("flickr-photos-licenses-setLicense-updater",(function(e,s){"use strict";e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:function(o,n){var t={};return o.fullResponse?(t.photo_ids=o.photoId,t.full_response=1):t.photo_id=o.photoId,t.license_id=o.license,n.callAPI("flickr.photos.licenses.setLicense",t).then((function(e){if("errors"in e)return e.api="setLicense",e}),(function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setLicense"),e})).then(null,e.FetcherErrorLogger(s))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setSafetyLevel-updater",(function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:function(o,r){var s={};return o.fullResponse?(s.photo_ids=o.photoId,s.full_response=1):s.photo_id=o.photoId,s.safety_level=o.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",s).then((function(e){if("errors"in e)return e.api="setSafety",e}),(function(e){throw o.fullResponse&&(e.photoIds=o.photoId,e.returnApi="setSafety"),e})).then(null,e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photos-setContentType-updater",(function(t,e){"use strict";t.namespace("ModelUpdaters")["flickr-photos-setContentType"]={run:function(o,n){var r={};return o.fullResponse?(r.photo_ids=o.photoId,r.full_response=1):r.photo_id=o.photoId,r.content_type=o.contentType+1,n.callAPI("flickr.photos.setContentType",r).then((function(t){if("errors"in t)return t.api="setContentType",t}),(function(t){throw o.fullResponse&&(t.photoIds=o.photoId,t.returnApi="setContentType"),t})).then(null,t.FetcherErrorLogger(e))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("photo-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,o){var r=[];return("title"in o||"description"in o)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:o.title?o.title.newVal:this.getValue(t,"title"),description:o.description?o.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in o&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:o.license.newVal},this.appContext)),"safetyLevel"in o&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:o.safetyLevel.newVal},this.appContext)),"contentType"in o&&r.push(e.ModelUpdaters["flickr-photos-setContentType"].run({photoId:t,contentType:o.contentType.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,o){var r=[];return"safetyLevel"in o&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(o.safetyLevel,10),fullResponse:1},this.appContext)),"title"in o&&"description"in o?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:o.title,description:o.description,fullResponse:1},this.appContext)):"title"in o?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:o.title,fullResponse:1},this.appContext)):"description"in o&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:o.description,fullResponse:1},this.appContext)),"license"in o&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:o.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getSizeForCanvas:e.PhotoModelHelper.getSizeForCanvas,getPhotoLicenseInformation:e.PhotoModelHelper.getPhotoLicenseInformation,getGuestpass:function(t){var o=this;return new e.Promise((function(e,r){o.getValue(t,"guestpass")?e():o.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then((function(r){o.setValue(t,"guestpass",r.guestpass.url),e()}))}))},canVr:function(t){var o,r=!1;return this.appContext.flipper.isFlipped("enable-vr")?(this&&(o=this.getValue(t,"aspectRatio"))&&o>=1.99&&o<=2.01&&(r=!0),r?e.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:t})]).then((function(t){return e.Promise.resolve(!!t[0].is_equirectangular)})):e.Promise.resolve(!1)):e.Promise.resolve(!1)},attributes:{title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,contentType:e.PhotoModelHelper.attributes.contentType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,canPublicComment:e.PhotoModelHelper.attributes.canPublicComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,owner:{isModel:!0},engagement:{isModel:!0},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},sizesForAlbum:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(t){var o=this.getValue(t,"sizes");return e.Object.each(o,(function(e,t){e.src=e.url})),o}},stats:{isModel:!0},visibilitySource:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},isVideoPending:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVideoFailed:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},systemModerated:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","flickr-photos-setContentType-updater","attribute-helpers"]});