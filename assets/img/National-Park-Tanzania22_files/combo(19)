YUI.add("person-public-profile-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-profile-getProfile"].run(t,this.appContext)},updateField:function(t,r){return e.ModelUpdaters["flickr-profile-setProfile"].run(t,r)},updateFirstAndLastName:function(t,r){return e.ModelUpdaters["flickr-account-changeFirstAndLastName"].run(t,r)}},remoteUpdateDescription:function(e,t,r){return this.setValue(e,"description",t.description),this.remote.updateBioField(t,r)},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},joinedDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},showcaseSetId:{defaultValue:"0"},city:{},country:{},firstName:{},lastName:{},hometown:{},email:{},occupation:{},profileDescription:{},profileDescriptionExpanded:{},timezone:{},website:{},facebook:{},facebookUrl:{},instagram:{},instagramUrl:{},tumblr:{},tumblrUrl:{},twitter:{},twitterUrl:{},pinterest:{},pinterestUrl:{},totalViews:{},totalTags:{},totalGeotagged:{},totalFaves:{},totalInGroup:{}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-profile-getProfile-fetcher","flickr-profile-setProfile-updater","flickr-account-changeFirstAndLastName-updater","moment"]});YUI.add("flickr-account-changeUsername-updater",(function(e,n){"use strict";e.namespace("ModelUpdaters")["flickr-account-changeUsername"]={run:function(r,o){var s=(function(e){return{username:e.username}})(r);return new e.FlickrPromise({apiResponse:o.callAPI("flickr.account.changeUsername",s),personModel:o.getModel("person-models",r.id)}).then(function(e){return(function(e,n,r,o){var s=e.apiResponse,a=e.personModel;if(s)return s.newUsername&&void 0!==s.newUsername&&a.setValue("username",s.newUsername),s})(e)}.bind(this),e.FetcherErrorLogger(n))}}}),"@VERSION@",{requires:["flickr-promise"],optional:["person-public-profile-models"]});YUI.add("person-model-helper",(function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}}),"@VERSION@",{requires:[]});YUI.add("person-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},updateUsername:function(t,r){return e.ModelUpdaters["flickr-account-changeUsername"].run(t,r)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var r=this.getValue(t,"isPro"),n=this.getValue(t,"isAdFree");return r||n}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},expiringPartner:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},uploadCount:{defaultValue:null},uploadLimit:{defaultValue:null},uploadLimitStatus:{defaultValue:null},isCognitoUser:{defaultValue:null},hasAuthorizedMobile:{defaultValue:null},hasInvalidEmail:{defaultValue:!1},subscription:{defaultValue:{isPastDue:!1,isPro:!1,isClosed:!1}},contactsCacheUrl:{defaultValue:!1},segments:{defaultValue:[]},isEligibleForGifts:{defaultValue:!1},eligibleGifts:{defaultValue:[]},newFlow:{defaultValue:!1},marketingPrefsLink:{defaultValue:"",validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-account-changeUsername-updater","attribute-helpers","person-model-helper","moment"]});YUI.add("flickr-people-getInfo-fetcher",(function(e,s){"use strict";var r=new e.SubscriptionsHelper,i=require("hermes-core/flog")(s);e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:function(r,i){var o=this,t=i.getViewer();return t&&t.signedIn&&(r.id===t.nsid||r.nsid===t.nsid)&&(r.storage=1),new e.FlickrPromise({apiResponse:i.callAPI("flickr.people.getInfo",this._processParams(r,i),!0),personModelRegistry:i.getModelRegistry("person-models"),personRelationshipModelRegistry:i.getModelRegistry("person-relationship-models"),personProfileModelRegistry:i.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:i.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:i.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:i.getModelRegistry("person-notifications-models"),photostreamModelRegistry:i.getModelRegistry("photostream-models"),privilegesModelRegistry:i.getModelRegistry("privileges-models")}).then((function(e){return o._processResponse(e,r,i)}),e.FetcherErrorLogger(s))},_processParams:function(s,r){var i={datecreate:1,extras:e.APIHelper.request.getRebootPeopleExtras()};if(YUI.Env.isServer&&s.id===r.request.probableUser?(i.storage=1,i.extras+=","+["classic_user_id","timezone_dst","unified_search_view_pref","photostream_view_order_pref","photostream_view_as_pref","album_view_layout","download_pref","products_features","subscriptions","is_minor","privileges"].join(",")):r.getViewer().signedIn&&s.id===r.getViewer().nsid&&(i.extras+=","+["products_features","subscriptions"].join(",")),s.extras&&"string"==typeof s.extras&&s.extras.length>0&&(i.extras+=","+s.extras),s.id)i.user_id=s.id;else{if(!s.pathAlias)throw new Error("`fetch` is missing required params.");i.path_alias=s.pathAlias}return s.storage&&(i.storage=s.storage),i.extras||(i.extras=""),i.extras+=", has_stats",i},_processResponse:function(s,o,t){var a,n,l,p=s.apiResponse,d=s.personModelRegistry,g=s.personRelationshipModelRegistry,u=s.personProfileModelRegistry,m=s.personPreferencesModelRegistry,c=s.personGroupsModelRegistry,h=s.personNotificationsModelRegistry,f=s.photostreamModelRegistry,v=s.privilegesModelRegistry,M=p.person,y=t.getViewer(),R=M.id,_=y&&y.signedIn&&R===y.nsid;return l={id:R,pathAlias:M.pathAlias,username:M.username&&M.username._content,realname:M.realname&&M.realname._content,buddyicon:e.APIHelper.response.removeProtocolFromURL(M.iconurls),isAdFree:M.isAdFree,isPro:M.ispro,proBadge:M.proBadge,isMinor:M.isMinor,hasStats:M.hasStats,location:M.location&&M.location._content,hasAdfree:M.hasAdfree,has1TB:M.has1TB,has2TB:M.has2TB,hasUnlimitedStorage:M.hasUnlimitedStorage,hasFreeStandardShipping:M.hasFreeStandardShipping,hasFreeEducationalResources:M.hasFreeEducationalResources,dateCreated:M.datecreate._content,expiringPartner:M.expiringPartner},M.ispro&&(l.proExpireDate=M.expire),M.gift&&(l.isEligibleForGifts=M.gift.giftEligible||!1,l.eligibleGifts=M.gift.eligibleDurations||[],l.newFlow=M.gift.newFlow||!1),_&&(M.uploadLimits?(l.uploadLimit=M.uploadLimits.uploadLimit,l.uploadCount=M.uploadLimits.uploadCount):(l.uploadLimit=M.uploadLimit,l.uploadCount=M.uploadCount),l.uploadLimitStatus=M.uploadLimitStatus,l.isCognitoUser=M.isCognitoUser,l.hasInvalidEmail=!1,M.email&&(!M.email||M.email._content&&""!==M.email._content)?M.email._content&&-1===M.email._content.indexOf("@")?l.hasInvalidEmail=!0:l.hasInvalidEmail=!1:l.hasInvalidEmail=!0,l.isPro&&(l.subscription=r.parseEffectiveSubscriptionData(!0,p.effectiveSubscriptions)),M.contactsCacheUrl&&(l.contactsCacheUrl=M.contactsCacheUrl),M.segments&&M.segments.length?(l.segments=M.segments,i.info("User belongs to these segments",l.segments)):i.info("User is not in any segment"),M.email&&M.email.prefsLink&&(l.marketingPrefsLink=M.email.prefsLink)),d.addOrUpdate(l),h.addOrUpdate({id:R,unreadFlickrMailCount:M.unreadMessages?M.unreadMessages.content:0}),g.addOrUpdate({id:R,pathAlias:M.pathAlias,isContact:M.contact,isFriend:M.friend,isFamily:M.family,isIgnored:M.ignored,isIgnoredBy:M.ignoredby,isRevContact:M.revcontact,isRevFriend:M.revfriend,isRevFamily:M.revfamily}),_&&(n={id:R},M.safeSearch&&(n.safeSearch=(M.safeSearch||1)-1),M.viewPrefs&&(n.unifiedSearchViewPref=M.viewPrefs.unifiedSearchViewPref,n.photostreamViewOrderPref=M.viewPrefs.photostreamViewOrderPref,n.photostreamViewAsPref=M.viewPrefs.photostreamViewAsPref,n.albumViewLayoutPref=M.viewPrefs.albumViewLayout,n.galleryViewLayoutPref=M.viewPrefs.galleriesViewLayoutPref),m.exists(R)?m.setValues(R,n):m.add(n),M.privileges&&v.addOrUpdate({id:R,privileges:M.privileges,uploadLimits:M.uploadLimits})),a={id:R,coverPhotoUrls:e.APIHelper.response.removeProtocolFromURL(M.coverphoto_url),photoCount:M.photos.count.content,location:M.location?M.location.content:null,arrPhotoCount:M.all_rights_reserved_photos_count},M.storage&&(a.storageUsed=M.storage.used.content,a.storageTotal=M.storage.total.content),M.unreadMessages&&(a.unreadMessages=M.unreadMessages.content),u.addOrUpdate(a),c.addOrUpdate({id:R,memberCount:M.groupMemberships?M.groupMemberships.member:null,moderatorCount:M.groupMemberships?M.groupMemberships.moderator:null,adminCount:M.groupMemberships?M.groupMemberships.admin:null,invitedCount:M.groupMemberships?M.groupMemberships.invited:null}),f.addOrUpdate({id:R,pathAlias:M.pathAlias,owner:d.proxy(R),totalItems:M.photos.count&&M.photos.count.content}),M}}}),"@VERSION@",{requires:["flickr-promise","subscriptions-helper"],optionalRequires:["hermes-core"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","person-notifications-models","privileges-models","api-helper"]});YUI.add("person-relationship-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[],n={};return e.Lang.isObject(i,!0)&&(n.user_id=t,n.friend=this.getValue(t,"isFriend"),n.family=this.getValue(t,"isFamily"),"isContact"in i&&(i.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(n,this.appContext))),("isFriend"in i||"isFamily"in i)&&("isFriend"in i&&(n.friend=i.isFriend.newVal),"isFamily"in i&&(n.family=i.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(n,this.appContext))),"isIgnored"in i&&(!0===i.isIgnored.newVal?r.push(e.ModelUpdaters["flickr-contacts-block"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(n,this.appContext)))),e.Promise.all(r)}},toggleFollowing:function(e){this.getValue(e,"isContact")?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){this.getValue(e,"isFriend")?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){this.getValue(e,"isFamily")?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){this.getValue(e,"isIgnored")?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var i=this.appContext.getViewer();return!!i&&this.getValue(t,"nsid")===i.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});YUI.add("math-helper",(function(e){e.MathHelper=function(e){return{seedRandom:function(e){return 0+1*((e=(9301*e+49297)%233280)/233280)}}}}),"@VERSION@",{requires:[]});YUI.add("banner-helper",(function(e,i){var n=require("hermes-core/flog")(i),o=e.mix({langBundles:this.details.langBundles},e.Localizable),r=new e.SubscriptionsHelper;e.BannerHelper=function(i){var t=this,s=[],a=[],l={tempServerless:function(e){return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){let e=i.getCookie("force_serverless");return"1"===e||"2"===e},viewName:"serverless-api-banner-view",viewConfig:{}}},loginMigration:function(e){return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){var e=!1,n=i.getViewer().isCognitoUser;return i.getViewer().signedIn&&!n&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&(e=!0),e},viewName:"login-migration-banner-view",viewConfig:{}}},pastDue:function(e){var n;function o(){return-1===["pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","account-settings-view"].indexOf(i.flapp.get("activeView").name)}return{priority:"priority"in e?e.priority:Number.MAX_VALUE,placement:"placement"in e?e.placement:"header",load:function(){var e=i.getViewer();return e.signedIn&&e.isPro?i.getModel("person-models",e.nsid).then((function(e){var i=e.getValue("subscription");n=i.isPastDue})):(n=!1,Promise.resolve())},canShowBanner:function(){var e=!1;return i.getViewer().signedIn&&i.getViewer().isPro&&o()&&n&&(e=!0),e&&o()},viewName:"past-due-banner-view",viewConfig:{}}},migrateSubscription:function(n){var o="priority"in n?n.priority:Number.MAX_VALUE,t="placement"in n?n.placement:"header",s=!1,a=!1;return{priority:o,placement:t,load:function(){var n=i.getViewer();return n.signedIn&&n.isPro?i.getModel("effective-subscriptions-models",n.nsid).then(function(n){if(n&&n.getValue("length")>0){var o=r.getEligibleSubscription(n,!0);o&&(s=o.isBraintreeSubscription||o.isDigitalRiverSubscription&&i.flipper.isFlipped("enable-dr-paypal-migrate-banner"),a=o.nextBillingDate&&o.nextBillingDate.isBefore&&o.nextBillingDate.isBefore(e.moment().add(15,"days")))}}.bind(this)):(s=!1,Promise.resolve())},canShowBanner:function(){var n=!1;return i.getViewer().signedIn&&i.getViewer().isPro&&s&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&(!i.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)||i.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)&&a)&&(n=!0),n},viewName:"subscription-migrate-banner-view",viewConfig:{}}},cookie:function(n){return{priority:"priority"in n?n.priority:Number.MAX_VALUE,placement:"placement"in n?n.placement:"footer",load:function(){return Promise.resolve()},canShowBanner:function(){return!i.getCookie(e.config.flickr.banners.dismiss_cookie_banner_name)&&!i.requiresCookieConsent},viewName:"cookie-banner-view",viewConfig:{}}},cookieConsent:function(e){var n,o="priority"in e?e.priority:Number.MAX_VALUE,r="placement"in e?e.placement:"footer";return{priority:o,placement:r,load:function(){return i.trustarcConsentManager?new Promise(((e,o)=>{n=setTimeout(e,1e4),i.trustarcConsentManager.onReady((()=>{clearTimeout(n),e()}))})):Promise.resolve()},canShowBanner:function(){var e=i.flipper.isFlipped("enable-cookie-consent-execution-hermes")&&i.requiresCookieConsent&&"truste"in window&&"PrivacyManagerAPI"in window;if(e){var n=window.truste.cma.callApi("getConsentDecision","flickr.com");n&&(e=0===n.consentDecision)}return e},viewName:"trustarc-consent-banner-view",viewConfig:{}}},uploadLimit:function(n){var o;return{priority:"priority"in n?n.priority:Number.MAX_VALUE,placement:"placement"in n?n.placement:"header",load:function(){return i.getViewer().signedIn?i.getModel("person-profile-models",i.getViewer().nsid).then((function(e){o=e})):Promise.resolve()},canShowBanner:function(){var n=!i.getCookie(e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isOverARRLimit(o,i)&&"products-flickrpro-route"!==i.routeConfig.module,r=!i.getCookie(e.config.flickr.upload_blocking.dismiss_at_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isAtUploadLimit(o,i),t=!i.getCookie(e.config.flickr.upload_blocking.dismiss_near_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isNearUploadLimit(o,i);return i.flipper.isFlipped("enable-upload-limit-messages")&&i.getViewer().signedIn&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&(n||r||t)},viewName:"upload-limit-banner-view",viewConfig:{}}},surveyModal:function(n){var o="priority"in n?n.priority:Number.MAX_VALUE,r="placement"in n?n.placement:"header";let t,s=new e.MathHelper,a="",l=e.config.flickr.geo,p=i.lang?i.lang.substr(0,2):"",c=!1;return p&&["en","es","fr","de","it","zh"].indexOf(p)>-1&&["CA"].indexOf(l.countryCode)>-1&&(c=!0,a="J9GRTSW"),{priority:o,placement:r,load:function(){let e=i.getViewer();return e.signedIn?i.getModel("person-models",e.nsid).then((function(e){t=e})):Promise.resolve()},canShowBanner:function(){let n=!1,o=t?t.getValue("nsid"):void 0,r=new URLSearchParams(window.location.search);if(i.flipper.isFlipped("enable-feedback-modal")){var l=!0,p=o?parseInt(o.substring(0,o.indexOf("@"))):(w=1e8,d=999999999,Math.floor(Math.random()*(d-w)+w));p&&(l=i.viewportData.getWidth()>700?s.seedRandom(p)<.3:s.seedRandom(p)<.6),!YUI.Env.isServer&&l&&i.getViewer().signedIn&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&"photostream-route"!==i.routeConfig.module&&!window.localStorage.getItem(e.config.flickr.banners.dismiss_survey_modal_name)&&window.URLSearchParams&&c&&(n=!0)}var w,d;return!i.flipper.isFlipped("enable-force-feedback-modal")||YUI.Env.isServer||window.localStorage.getItem(e.config.flickr.banners.dismiss_survey_modal_name)||(n=!0),i.flipper.isFlipped("enable-feedback-modal")&&r.has("survey")&&(n=!0),n&&a},viewName:"feedback-prompt-view",viewConfig:{surveyKey:a}}},defaultSafetyMigration:function(e){var n,t,s="priority"in e?e.priority:Number.MAX_VALUE,a="placement"in e?e.placement:"header",l=i.getViewer(),p=r.getProLandingPageUrl(r.UTM_SAFETY_UPSELL,{source:i.flapp.get("activeView").isMobile?"mobile":"desktop",medium:"defaultSafetyChangeModal"});return{priority:s,placement:a,load:function(){return l.signedIn?Promise.all([i.getModel("privileges-models",l.nsid),i.getModel("account-settings-models",l.nsid,{user_id:l.nsid})]).then((e=>{n=e[0],t=e[1]})).catch((e=>{console.log(e)})):Promise.resolve()},canShowBanner:function(){let e=!1;return YUI.Env.isServer||!l.signedIn||-1!==["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)||"safe"===t.getValue("permissions").defaultUploads.defaultSafetyLevel||n.getValue("privileges").canSetNonSafe||(e=!0),e},viewName:"confirmation-dialog-view",viewConfig:{appContext:i,title:o.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_TITLE"}),htmlMessage:o.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_BODY"})+"<br>"+o.intlHTMLMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_MORE_INFO",blogPostURL:"https://www.flickrhelp.com/hc/en-us/articles/13690320471060-Free-account-limit-changes-and-enforcement"}),confirmButtonText:o.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_UPGRADE"}),cancelButtonText:o.intlMessage({intlName:"banners.DEFAULT_SAFETY_CHANGE_MODAL_CHANGE"}),showCloseXButton:!1,onConfirm:async(e,n)=>{n.setLoading({confirm:"loading"}),i.flapp.navigate(p)},onCancel:async(e,n)=>{n.setLoading({cancel:"loading"}),i.callAPI("flickr.prefs.setSafetyLevel",{safety_level:1}).then((function(e){var i;if("ok"!==e.stat)throw e;(i=t.getValue("permissions")).defaultUploads.defaultSafetyLevel="safe",t.setValue("permissions",i),n.fire("dismiss")}),(function(e){console.log(e)}))}},containerConfig:{dismissOnOverlayClick:!1,hasSubviewConfigRefactor:!0}}},exploredUpsell:function(n){var o="priority"in n?n.priority:Number.MAX_VALUE,r="placement"in n?n.placement:"header",t=i.getViewer(),s=!1;return{priority:o,placement:r,load:function(){return t.isPro||i.segments.hasSegment("explored_non_pro_users")&&(s=!0),Promise.resolve()},canShowBanner:function(){return!t.isPro&&s&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&!i.getCookie(e.config.flickr.banners.dismiss_explored_upsell_banner_name)},viewName:"explored-upsell-banner-view",viewConfig:{}}},churnedProBanner:function(n){var o="priority"in n?n.priority:Number.MAX_VALUE,r="placement"in n?n.placement:"header",t=i.getViewer(),s=!1;return{priority:o,placement:r,load:function(){return t.isPro||i.segments.hasSegment("pro_churned_user_1_month")&&(s=!0),Promise.resolve()},canShowBanner:function(){return s&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)&&!i.getCookie(e.config.flickr.banners.dismiss_churned_pro_banner_name)},viewName:"churned-pro-banner-view",viewConfig:{}}},mfy23Banner:function(n){return{priority:"priority"in n?n.priority:Number.MAX_VALUE,placement:"placement"in n?n.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){return i.flipper.isFlipped("enable-nextjs-mfy-2023")&&(function(){let e=["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"];return e.push("stats-page-view"),-1===e.indexOf(i.flapp.get("activeView").name)})()&&!i.getCookie(e.config.flickr.banners.dismiss_mfy23_banner_name)},viewName:"mfy23-banner-view",viewConfig:{}}},"20thBDayBanner":function(n){var o="priority"in n?n.priority:Number.MAX_VALUE,r="placement"in n?n.placement:"header",t=i.getViewer(),s=new Date("2024-02-04T08:00:00.000Z"),a=new Date("2024-02-16T07:59:59.000Z");return i.flipper.isFlipped("enable-force-flickr-20-bday-timed-features")&&(s=new Date(Date.now()-36e5),a=new Date(Date.now()+36e5)),{priority:o,placement:r,load:function(){return Promise.resolve()},canShowBanner:function(){return!t.isPro&&!i.getCookie(e.config.flickr.banners.dismiss_20th_bday_banner_name)&&i.flipper.isFlipped("enable-flickr-20-bday-early-features")&&-1===["products-pro-view","pro-checkout-view","sohp-slideshow-features-view","sohp-slideshow-scroll-view","sohp-slideshow-photolist-view","sohp-slideshow-sohp-e-view","sohp-slideshow-view","download-page-view","chrome-page-view"].indexOf(i.flapp.get("activeView").name)},viewName:"twentieth-bday-banner-view",viewConfig:{},startTime:s,endTime:a}},ybs23ResultsExplore:function(n){return{priority:"priority"in n?n.priority:Number.MAX_VALUE,placement:"placement"in n?n.placement:"header",load:function(){return Promise.resolve()},canShowBanner:function(){return!i.getCookie(e.config.flickr.banners.dismiss_ybs23_results_explore_banner_name)&&"explore-page-view"===i.flapp.get("activeView").name},viewName:"ybs23-results-explore-banner-view",viewConfig:{},startTime:new Date("2024-01-25T05:00:00.000Z"),endTime:new Date("2024-01-26T04:55:00.000Z")}}};function p(){a=s.sort((function(e,i){return e.priority-i.priority}))}function c(e){var i,n,o=a.find((function(i,n){var o=void 0===e||i.placement===e,r=new Date,t=r<i.startTime||r>i.endTime;if(o&&!t&&i.canShowBanner())return!0}));if(o)return i=s.indexOf(o),-1!==(n=i)&&(s.splice(n,1),p()),o}return this.loadBanners=function(e){var i;return s=[],a=[],i=e.map((function(e){return(function(e){var i=new l[e.type]({priority:e.priority,placement:e.placement});return i?i.load().then((function(){!(function(e){s.push(e),p()})(i)})).catch((function(e){n.error("Failed to load and register banner.",{err:e})})):Promise.resolve()})(e)})),Promise.all(i)},this.getBanners=function(e){var i=[];return e.forEach((function(e){var n=c(e);n&&i.push(n)})),i},this.getQueue=function(){return a},this.typeObjects=l,this.renderBannerView=function(e){return(function(e){return i.getView(e.viewName,e.viewConfig).then((function(e){var n;return i.getView("banner-view",{subview:e}).then((function(e){return(n=e).initialize()})).then((function(){return n}))}),(function(e){n.warn("Error loading banner view",{err:e})}))})(e).then((function(i){t.fire("renderBanner",{placement:e.placement,bannerView:i,containerConfig:e.containerConfig})}))},this},e.augment(e.BannerHelper,e.EventTarget)}),"@VERSION@",{requires:["banner-view","event-custom","effective-subscriptions-models","person-models","subscriptions-helper","math-helper","moment"],optionalRequires:["hermes-core"],langBundles:["banners"]});